<!DOCTYPE html>
<html lang="en">
<head>
    <title>Client - Liberty</title>
    <link href="~/Content/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/Content/liberty.css" rel="stylesheet">
    <link href="~/Content/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div id="wrapper">
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">Liberty Client Log-on</a>
            </div>
            <ul class="nav navbar-top-links navbar-right">
                <li>
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>
                    </a>
                </li>
                <li>
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-power-off fa-fw"></i>
                    </a>
                </li>
            </ul>
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </span>
                            </div>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-edit fa-fw"></i>Capture Details</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-bullseye fa-fw"></i>Saving Goals</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-beer fa-fw"></i>Holiday Check</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-certificate fa-fw"></i>Cashback</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-fire fa-fw"></i>Emergency</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-gamepad fa-fw"></i>Own your life</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-cube fa-fw"></i>Life Plan</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-female fa-fw"></i>Family</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-flask fa-fw"></i>Risks</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        @RenderBody()
    </div>
    <script>
        function SaveAndContinue(id) {
            SaveClientData(function(data) {
                    if (data.status === "Success") {
                        $("#" + id).click();
                        fade();

                    }
                    else {
                        alert("Error occurs on the Database level!");
                    }
            }, false, false);
        }

        function Finish() {
            SaveClientData(function (data) {
                if (data.status === "Success") {
                    alert('Done. Redirect to landing page here...');
                }
                else {
                    alert("Error occurs on the Database level!");
                }
            }, true, false);
        }

        function HelpMe() {
            SaveClientData(function (data) {
                if (data.status === "Success") {
                    alert('Send your stuff here ');
                }
                else {
                    alert("Oops");
                }
            }, true, true);
        }

        function SaveClientData(successCallback, isComplete, isHelperCall) {
            var payload = GetClientDetails(isComplete, isHelperCall);

            $.ajax({
                url: "/Client/Save",
                type: "POST",
                data: JSON.stringify(payload),
                dataType: "json",
                traditional: true,
                contentType: "application/json; charset=utf-8",
                success: successCallback,
                error:  function() {
                    alert("An error has occured!!!");
                }
            });
        }

        function fade() {
            $('#support-tag').fadeOut(350);
            $('#support-tag').fadeIn(350);
            window.setTimeout("$('#support-tag').fadeOut(350); $('#support-tag').fadeIn(350);", 2500);
            window.setTimeout("$('#support-tag').fadeOut(350); $('#support-tag').fadeIn(350);", 5000);
        }

        function GetClientDetails(isComplete, isHelperCall) {
            var sessionId = $('#txtSessionId').val();
            var name = $('#txtName').val();
            var personal = GetPersonal();
            var address = GetAddress();
            var contact = GetContact();

            var session = {
                "Id": sessionId,
                "Name": name,
                "CurrentStep": (isHelperCall ? getCurrentStep() : getCurrentSaveStep()),
                "AddressDetails": address,
                "ContactDetail": contact,
                "PersonalDetails": personal,
                "IsCompleted": isComplete
            };

            return session;
        }

        function getCurrentSaveStep() {
            if ($('#personal').hasClass('active'))
                return 'Address';
            else if ($('#address').hasClass('active'))
                return 'Contact';
            return 'Personal';
        }

        function getCurrentStep() {
            if ($('#personal').hasClass('active'))
                return 'Personal';
            else if ($('#address').hasClass('active'))
                return 'Address';
            return 'Contact';
        }

        function GetPersonal() {
            var firstname = $('#txtFirstName').val();
            var surname = $('#txtSurname').val();
            var idnumber = $('#txtIdNumber').val();
            var nodependants = $("#ddlNoDependants option:selected").text();

            var personal = {
                "FirstName": firstname,
                "Surname": surname,
                "IdNo": idnumber,
                "NoOfDependants": nodependants
            }
            return personal;
        }

        function GetAddress() {

            var street = $('#txtStreet').val();
            var suburb = $('#txtSuburb').val();
            var city = $('#txtCity').val();
            var province = $("#ddlProvince option:selected").text();
            var code = $('#txtCode').val();

            var address = {
                "PhysicalAddressStreet": street,
                "PhysicalAddressSuburb": suburb,
                "PhysicalAddressCity": city,
                "PhysicalAddressProvince": province,
                "PhysicalAddressCode": code
            }
            return address;
        }

        function GetContact() {
            var email = $('#txtEmail').val();
            var cellNo = $('#txtCellNo').val();
            var homeNo = $('#txtHomeNo').val();
            var workNo = $('#txtWorkNo').val();
            var altNo = $('#txtAltNo').val();

            var contact = {
                "EmailAddress": email,
                "Cellphone": cellNo,
                "Home": homeNo,
                "Work": workNo,
                "Alternative": altNo
            }
            return contact;
        }

    </script>
    <script src="~/Content/jquery/dist/jquery.min.js"></script>
    <script src="~/Content/bootstrap/dist/js/bootstrap.min.js"></script>
</body>
</html>
